<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>B2B Portal - Innenfor</title>
  <style>
    :root{
      --green:#3f5a4f;
      --green-dark:#2f463d;
      --cream:#f5f3ee;
      --card:#ffffff;
      --accent:#d97b61;
      --text:#3f5a4f;
      --text-light:#6b7f75;
    }
    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body{
      background:#f9f7f4;
      color:var(--text);
    }
    .b2b-container{
      display:grid;
      grid-template-columns:280px 1fr;
      min-height:100vh;
    }
    .sidebar{
      background:var(--green-dark);
      color:#fff;
      padding:30px 20px;
      overflow-y:auto;
    }
    .sidebar-header{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:40px;
      font-size:20px;
      font-weight:700;
    }
    .sidebar-menu{
      list-style:none;
    }
    .sidebar-menu li{
      margin-bottom:15px;
    }
    .sidebar-menu a{
      color:#fff;
      text-decoration:none;
      padding:10px 15px;
      display:block;
      border-radius:8px;
      cursor:pointer;
      transition:background .3s;
    }
    .sidebar-menu a:hover,
    .sidebar-menu a.active{
      background:var(--green);
    }
    .logout-btn{
      margin-top:40px;
      padding:12px 15px;
      background:var(--accent);
      color:#fff;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-size:14px;
      width:100%;
    }
    .main-content{
      padding:40px;
      overflow-y:auto;
    }
    .header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:30px;
    }
    .header h1{
      font-size:28px;
      color:var(--green-dark);
    }
    .section{
      display:none;
    }
    .section.active{
      display:block;
    }
    .dashboard-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:20px;
      margin-bottom:30px;
    }
    .metric-card{
      background:#fff;
      padding:20px;
      border-radius:12px;
      box-shadow:0 4px 20px rgba(0,0,0,.06);
    }
    .metric-card h3{
      font-size:14px;
      color:var(--text-light);
      margin-bottom:10px;
    }
    .metric-value{
      font-size:32px;
      font-weight:700;
      color:var(--green-dark);
    }
    .card{
      background:#fff;
      border-radius:12px;
      padding:20px;
      box-shadow:0 4px 20px rgba(0,0,0,.06);
      margin-bottom:20px;
    }
    .table-container{
      background:#fff;
      border-radius:12px;
      padding:20px;
      box-shadow:0 4px 20px rgba(0,0,0,.06);
      overflow-x:auto;
      margin-bottom:20px;
    }
    table{
      width:100%;
      border-collapse:collapse;
    }
    thead{
      background:#f5f3ee;
      border-bottom:2px solid #e8e4df;
    }
    th{
      padding:12px;
      text-align:left;
      font-weight:600;
      color:var(--text);
    }
    td{
      padding:12px;
      border-bottom:1px solid #e8e4df;
    }
    .status-badge{
      display:inline-block;
      padding:6px 12px;
      border-radius:20px;
      font-size:12px;
      font-weight:600;
    }
    .status-planlagt{
      background:#fce8e3;
      color:var(--accent);
    }
    .status-levert{
      background:#a8d5ca;
      color:#fff;
    }
    .btn{
      background:var(--accent);
      color:#fff;
      border:none;
      padding:10px 20px;
      border-radius:8px;
      cursor:pointer;
      font-size:14px;
      transition:background .3s;
    }
    .btn:hover{
      background:#c56a52;
    }
    .btn-green{
      background:var(--green-dark);
    }
    .btn-green:hover{
      background:var(--green);
    }
    .form-group{
      margin-bottom:15px;
    }
    .form-group label{
      display:block;
      margin-bottom:5px;
      font-weight:500;
    }
    .form-group input,
    .form-group select,
    .form-group textarea{
      width:100%;
      padding:10px 12px;
      border:1px solid #ddd;
      border-radius:8px;
      font-size:14px;
      font-family:inherit;
    }
    .modal{
      display:none;
      position:fixed;
      z-index:1000;
      left:0;
      top:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.5);
      justify-content:center;
      align-items:center;
    }
    .modal.show{
      display:flex;
    }
    .modal-content{
      background:#fff;
      border-radius:12px;
      padding:30px;
      max-width:600px;
      width:90%;
      box-shadow:0 20px 60px rgba(0,0,0,0.3);
    }
    .modal-close{
      position:absolute;
      right:20px;
      top:20px;
      font-size:28px;
      cursor:pointer;
      color:#999;
    }
    .celebration{
      background:linear-gradient(135deg, var(--green-dark) 0%, var(--green) 100%);
      color:#fff;
      padding:30px;
      border-radius:12px;
      text-align:center;
      margin-bottom:30px;
    }
    .celebration h2{
      color:#fff;
      margin-bottom:10px;
    }
  </style>
</head>
<body>

<div class="b2b-container">
  <div class="sidebar">
    <div class="sidebar-header">‚ô• Innenfor</div>
    <ul class="sidebar-menu">
      <li><a href="#" onclick="switchSection('dashboard')" class="menu-item active">Dashboard</a></li>
      <li><a href="#" onclick="switchSection('employees')" class="menu-item">Ansatte</a></li>
      <li><a href="#" onclick="switchSection('orders')" class="menu-item">Ordrer</a></li>
      <li><a href="#" onclick="switchSection('holidays')" class="menu-item">H√∏ytider</a></li>
      <li><a href="#" onclick="switchSection('reports')" class="menu-item">Rapporter</a></li>
      <li><a href="#" onclick="switchSection('settings')" class="menu-item">Innstillinger</a></li>
    </ul>
    <button class="logout-btn" onclick="logout()">Logg ut</button>
  </div>

  <div class="main-content">
    <div class="header">
      <h1>Bedriftens portal</h1>
      <div>
        <span id="currentUser" style="color: var(--green-dark); font-weight: 600;"></span>
      </div>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" class="section active">
      <div class="celebration">
        <h2>Velkommen tilbake! üéâ</h2>
        <p>Din bedrift bidrar til inkludering og fellesskap</p>
      </div>

      <div class="dashboard-grid">
        <div class="metric-card">
          <h3>Ansatte</h3>
          <div class="metric-value" id="employeeCount">0</div>
        </div>
        <div class="metric-card">
          <h3>Aktive ordrer</h3>
          <div class="metric-value" id="activeOrders">0</div>
        </div>
        <div class="metric-card">
          <h3>H√∏ytider denne √•ret</h3>
          <div class="metric-value" id="holidaysCount">6</div>
        </div>
        <div class="metric-card">
          <h3>Totalt investert</h3>
          <div class="metric-value" id="totalSpent">0 kr</div>
        </div>
      </div>

      <h2 style="color: var(--green-dark); margin: 40px 0 20px;">Kommende h√∏ytider</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>H√∏ytid</th>
              <th>Dato</th>
              <th>Antall gaver</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="upcomingHolidaysTable">
            <tr>
              <td>Eid al-Fitr</td>
              <td>11. Mars 2026</td>
              <td>0</td>
              <td><span class="status-badge status-planlagt">Planlagt</span></td>
            </tr>
            <tr>
              <td>Jul</td>
              <td>25. Desember 2025</td>
              <td>0</td>
              <td><span class="status-badge status-planlagt">Planlagt</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- EMPLOYEES -->
    <div id="employees" class="section">
      <button class="btn btn-green" onclick="openEmployeeModal()" style="margin-bottom: 20px;">+ Legg til ansatt</button>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Navn</th>
              <th>E-post</th>
              <th>Avdeling</th>
              <th>Handling</th>
            </tr>
          </thead>
          <tbody id="employeesTable">
          </tbody>
        </table>
      </div>
    </div>

    <!-- ORDERS -->
    <div id="orders" class="section">
      <button class="btn btn-green" onclick="openOrderModal()" style="margin-bottom: 20px;">+ Ny ordre</button>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Ordre ID</th>
              <th>Ansatt</th>
              <th>H√∏ytid</th>
              <th>Status</th>
              <th>Leveringsdato</th>
            </tr>
          </thead>
          <tbody id="ordersTable">
          </tbody>
        </table>
      </div>
    </div>

    <!-- HOLIDAYS -->
    <div id="holidays" class="section">
      <h2 style="color: var(--green-dark); margin-bottom: 20px;">Planlegg h√∏ytider</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
        <div class="card">
          <h3 style="color: var(--green-dark); margin-bottom: 15px;">üåô Eid al-Fitr</h3>
          <p style="color: var(--text-light); margin-bottom: 15px;">Islam - Fastebrekk festival</p>
          <button class="btn" onclick="planHoliday('Eid al-Fitr')">Planlegg</button>
        </div>
        <div class="card">
          <h3 style="color: var(--green-dark); margin-bottom: 15px;">üéÑ Jul</h3>
          <p style="color: var(--text-light); margin-bottom: 15px;">Kristendom - Julen</p>
          <button class="btn" onclick="planHoliday('Jul')">Planlegg</button>
        </div>
        <div class="card">
          <h3 style="color: var(--green-dark); margin-bottom: 15px;">ü™î Diwali</h3>
          <p style="color: var(--text-light); margin-bottom: 15px;">Hinduisme - Lysfestivalen</p>
          <button class="btn" onclick="planHoliday('Diwali')">Planlegg</button>
        </div>
        <div class="card">
          <h3 style="color: var(--green-dark); margin-bottom: 15px;">üïé Hanukkah</h3>
          <p style="color: var(--text-light); margin-bottom: 15px;">J√∏dedom - Hanukka</p>
          <button class="btn" onclick="planHoliday('Hanukkah')">Planlegg</button>
        </div>
        <div class="card">
          <h3 style="color: var(--green-dark); margin-bottom: 15px;">üå∏ Nowruz</h3>
          <p style="color: var(--text-light); margin-bottom: 15px;">Persisk - Nytt√•rsfeiring</p>
          <button class="btn" onclick="planHoliday('Nowruz')">Planlegg</button>
        </div>
        <div class="card">
          <h3 style="color: var(--green-dark); margin-bottom: 15px;">üê£ P√•ske</h3>
          <p style="color: var(--text-light); margin-bottom: 15px;">Kristendom - P√•sken</p>
          <button class="btn" onclick="planHoliday('P√•ske')">Planlegg</button>
        </div>
      </div>
    </div>

    <!-- REPORTS -->
    <div id="reports" class="section">
      <h2 style="color: var(--green-dark); margin-bottom: 20px;">Rapporter</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
        <button class="btn btn-green" onclick="generateReport('inkludering')" style="padding: 20px; font-size: 16px;">
          üìä Inkluderingsoversikt
        </button>
        <button class="btn btn-green" onclick="generateReport('kostnad')" style="padding: 20px; font-size: 16px;">
          üí∞ Kostnadsrapport
        </button>
        <button class="btn btn-green" onclick="generateReport('deltagelse')" style="padding: 20px; font-size: 16px;">
          üë• Deltakelsesrapport
        </button>
      </div>
    </div>

    <!-- SETTINGS -->
    <div id="settings" class="section">
      <div class="card" style="max-width: 500px;">
        <h2 style="color: var(--green-dark); margin-bottom: 20px;">Bedriftsinnstillinger</h2>
        <div class="form-group">
          <label>Bedriftsnavn</label>
          <input type="text" id="companyName" placeholder="Bedriftsnavn" value="Min Bedrift">
        </div>
        <div class="form-group">
          <label>Kontaktperson</label>
          <input type="text" id="contactPerson" placeholder="Navn">
        </div>
        <div class="form-group">
          <label>E-postadresse</label>
          <input type="email" id="companyEmail" placeholder="bedrift@example.com">
        </div>
        <div class="form-group">
          <label>Adresse</label>
          <input type="text" id="companyAddress" placeholder="Gate 1, Postnummer By">
        </div>
        <button class="btn btn-green" onclick="saveSettings()">Lagre innstillinger</button>
      </div>
    </div>
  </div>
</div>

<!-- EMPLOYEE MODAL -->
<div id="employeeModal" class="modal">
  <div class="modal-content">
    <span class="modal-close" onclick="closeEmployeeModal()">&times;</span>
    <h2>Legg til ansatt</h2>
    <form onsubmit="handleAddEmployee(event)">
      <div class="form-group">
        <label>Navn</label>
        <input type="text" required>
      </div>
      <div class="form-group">
        <label>E-post</label>
        <input type="email" required>
      </div>
      <div class="form-group">
        <label>Avdeling</label>
        <input type="text" placeholder="F.eks. HR, IT, √òkonomi" required>
      </div>
      <button type="submit" class="btn btn-green" style="width: 100%; padding: 12px;">Legg til</button>
    </form>
  </div>
</div>

<!-- ORDER MODAL -->
<div id="orderModal" class="modal">
  <div class="modal-content">
    <span class="modal-close" onclick="closeOrderModal()">&times;</span>
    <h2>Opprett ny ordre</h2>
    <form onsubmit="handleCreateOrder(event)">
      <div class="form-group">
        <label>Ansatt</label>
        <select required>
          <option value="">Velg ansatt</option>
        </select>
      </div>
      <div class="form-group">
        <label>H√∏ytid</label>
        <select required>
          <option value="">Velg h√∏ytid</option>
          <option value="Eid al-Fitr">Eid al-Fitr</option>
          <option value="Jul">Jul</option>
          <option value="Diwali">Diwali</option>
          <option value="Hanukkah">Hanukkah</option>
          <option value="Nowruz">Nowruz</option>
          <option value="P√•ske">P√•ske</option>
        </select>
      </div>
      <div class="form-group">
        <label>Leveringsdato</label>
        <input type="date" required>
      </div>
      <button type="submit" class="btn btn-green" style="width: 100%; padding: 12px;">Opprett ordre</button>
    </form>
  </div>
</div>

<script>
  let currentUser = null;

  document.addEventListener('DOMContentLoaded', function() {
    checkAuth();
    loadData();
  });

  // Universal storage wrapper for cross-platform compatibility
  const AppStorage = {
    setItem(key, value) { try { localStorage.setItem(key, value); } catch (e) { console.warn('Storage unavailable'); } },
    getItem(key) { try { return localStorage.getItem(key); } catch (e) { return null; } },
    removeItem(key) { try { localStorage.removeItem(key); } catch (e) {} }
  };

  function checkAuth() {
    const user = JSON.parse(AppStorage.getItem('innenfor_currentUser'));
    if (!user || user.type !== 'bedrift') {
      alert('Ikke autorisert. Du m√• v√¶re bedrift-bruker.');
      window.location.href = 'index.html';
      return;
    }
    currentUser = user;
    document.getElementById('currentUser').textContent = `${user.name} (Bedrift)`;
  }

  function loadData() {
    const employees = JSON.parse(AppStorage.getItem('b2b_employees') || '[]');
    document.getElementById('employeeCount').textContent = employees.length;
    
    const tbody = document.getElementById('employeesTable');
    tbody.innerHTML = employees.map(emp => `
      <tr>
        <td>${emp.name}</td>
        <td>${emp.email}</td>
        <td>${emp.department}</td>
        <td><button class="btn" onclick="editEmployee('${emp.id}')">Rediger</button></td>
      </tr>
    `).join('');
  }

  function switchSection(sectionName) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(sectionName).classList.add('active');
    
    document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
    event.target.classList.add('active');
  }

  function openEmployeeModal() {
    document.getElementById('employeeModal').classList.add('show');
  }

  function closeEmployeeModal() {
    document.getElementById('employeeModal').classList.remove('show');
  }

  function handleAddEmployee(event) {
    event.preventDefault();
    const employee = {
      id: Date.now().toString(),
      name: event.target[0].value,
      email: event.target[1].value,
      department: event.target[2].value
    };

    const employees = JSON.parse(localStorage.getItem('b2b_employees') || '[]');
    employees.push(employee);
    localStorage.setItem('b2b_employees', JSON.stringify(employees));
    
    alert('Ansatt lagt til!');
    closeEmployeeModal();
    loadData();
  }

  function openOrderModal() {
    document.getElementById('orderModal').classList.add('show');
  }

  function closeOrderModal() {
    document.getElementById('orderModal').classList.remove('show');
  }

  function handleCreateOrder(event) {
    event.preventDefault();
    
    // Hent verdier fra skjemaet
    const form = event.target;
    const employeeSelect = form.querySelector('select[name="employee"]') || form.querySelectorAll('select')[0];
    const holidaySelect = form.querySelector('select[name="holiday"]') || form.querySelectorAll('select')[1];
    const dateInput = form.querySelector('input[name="date"]') || form.querySelectorAll('input')[0];
    
    const order = {
      id: 'ORD-' + Date.now().toString().slice(-6),
      userId: currentUser.id,
      employeeId: employeeSelect.value,
      holiday: holidaySelect.value,
      date: dateInput.value,
      status: 'planlagt',
      recipientName: 'B2B Ordre',
      source: 'B2B',
      createdAt: new Date().toISOString()
    };
    
    let orders = JSON.parse(localStorage.getItem('innenfor_orders') || '[]');
    orders.push(order);
    localStorage.setItem('innenfor_orders', JSON.stringify(orders));
    alert('Ordre opprettet!');
    closeOrderModal();
  }

  function planHoliday(holiday) {
    alert(`Planlegger ${holiday}...`);
  }

  function generateReport(type) {
    alert(`Genererer ${type}-rapport...`);
  }

  function saveSettings() {
    alert('Innstillinger lagret!');
  }

  function logout() {
    AppStorage.removeItem('innenfor_currentUser');
    window.location.href = 'index.html';
  }

  function editEmployee(id) {
    alert('Rediger ansatt: ' + id);
  }
</script>

</body>
</html>
